# Environment variables
export XDG_CONFIG_HOME="$HOME/.config"
export EDITOR=nvim
export GOPATH="$HOME"
export LC_ALL=en_US.UTF-8
export PKG_CONFIG_PATH="$(brew --prefix openssl)/lib/pkgconfig"

# History settings
HISTFILE="$HOME/.zsh_history"
HISTSIZE=10000
SAVEHIST=10000
setopt hist_ignore_all_dups
setopt hist_ignore_space
setopt share_history
setopt EXTENDED_GLOB

# antidote
# Make sure antidote is installed
if ! command -v antidote &> /dev/null
then
    echo "antidote could not be found, please install it with brew"
    return
fi

# Source antidote from brew
source "$(brew --prefix)/opt/antidote/share/antidote/antidote.zsh"

zsh_plugins=${ZDOTDIR:-$HOME}/.zsh_plugins.txt

# Check if the plugins file exists
if [ -f "$zsh_plugins" ]; then
    # If the static file doesn't exist, or it's older than the plugins file
    if [[ ! -f "${zsh_plugins}.zsh" || "${zsh_plugins}.zsh" -ot "$zsh_plugins" ]]; then
        antidote bundle < "$zsh_plugins" > "${zsh_plugins}.zsh"
    fi
    source "${zsh_plugins}.zsh"
fi

# Modern CLI tools
eval "$(starship init zsh)"
eval "$(zoxide init zsh)"
eval "$(mise activate zsh)"

# ghq + fzf integration
function ghq-fzf() {
  local selected_dir=$(ghq list | fzf --query="$LBUFFER" --preview 'ghq list --full-path --exact {} | xargs eza --tree --level=1 --icons')
  if [ -n "$selected_dir" ]; then
    BUFFER="cd $(ghq root)/${selected_dir}"
    zle accept-line
  fi
  zle reset-prompt
}
zle -N ghq-fzf
bindkey '^]' ghq-fzf

# Path settings
export PATH="$HOME/.deno/bin:$PATH"
